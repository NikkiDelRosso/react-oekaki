{"version":3,"sources":["components/Oekaki/Layer.js","components/Oekaki/WorkingLayer.js","components/Oekaki/OekakiPage.js","components/Oekaki/Tools/Point.js","components/Oekaki/Tools/Brush.js","components/Oekaki/Tools/DrawingTool.js","components/Oekaki/Tools/Eraser.js","components/Oekaki/ToolIcon.js","components/helpers.js","components/Oekaki/Oekaki.js","App.js","serviceWorker.js","index.js"],"names":["Layer","width","height","name","this","canvas","getContext","layer","drawImage","clearRect","style","display","ref","data-layer-name","refs","Component","WorkingCanvas","clear","copyLayer","React","cloneElement","className","OekakiPage","oekaki","getLayer","i","layers","getActiveLayer","activeLayerIdx","newLayer","isBg","updateLayers","push","setActiveLayer","length","e","preventDefault","startDrawing","forceUpdate","splice","setState","oldPos","newPos","onMouseDown","bind","onTouchStart","map","idx","key","el","workingCanvas","Point","x","y","point","diff","getDiff","Math","sqrt","pow","atan2","Brush","color","size","opacity","icon","context","lineCap","lineJoin","strokeStyle","getColor","lineWidth","getSize","fillStyle","globalAlpha","getOpacity","strokeInfo","newColor","newSize","newOpacity","position","path","stroke","getStrokeInfo","getPath","moveTo","beginPath","fromPoint","toPoint","midpoint","getMidpoint","quadraticCurveTo","closePath","save","setDrawStyle","pathSegment","endPath","restore","positions","setPosition","unshift","toolIcon","iconObject","activeBool","console","log","setActive","Eraser","globalCompositeOperation","ToolIcon","onClick","tool","isActive","state","setIconObject","isActiveBool","title","getEventPositions","elem","zoom","events","getPosition","clientX","clientY","rect","getBoundingClientRect","type","touch","touches","changedTouches","target","Oekaki","history","redoHistory","flags","tools","brush","eraser","setCurrentTool","action","page","toolName","curToolName","currentTool","drawing","draw","hide","posish","activeLayer","addToPath","commitToLayer","show","clearPath","logAction","onMouseMove","drag","onMouseUp","stopDrawing","onTouchMove","onTouchEnd","Object","entries","toolKey","toolOnClickClosure","_","slice","reverse","layerName","prompt","addLayer","window","confirm","removeLayer","App","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.d27e8779.chunk.js","sourcesContent":["import React, { Component } from 'react';\n\nexport default class Layer extends Component {\n  constructor({ width, height, name }) {\n    super();\n    this.width = width;\n    this.height = height;\n    this.name = name;\n  }\n\n  get canvas() {\n    return this.refs.canvas;\n  }\n\n  getContext() {\n    return this.canvas.getContext('2d');\n  }\n\n  copyLayer(layer) {\n    let context = this.getContext();\n    context.drawImage(layer.canvas, 0, 0, layer.canvas.width, layer.canvas.height);\n    return this;\n  }\n\n  clear() {\n    this.getContext().clearRect(0, 0, this.canvas.width, this.canvas.height);\n    return this;\n  }\n\n  hide() {\n    this.canvas.style.display = 'none';\n  }\n\n  show() {\n    this.canvas.style.display = '';\n  }\n\n  render() {\n    return (\n      <canvas ref=\"canvas\"\n        data-layer-name={this.name}\n        width={this.width}\n        height={this.height}></canvas>\n    )\n  }\n}","import React from 'react';\nimport Layer from './Layer';\n\nexport default class WorkingCanvas extends Layer {\n  commitToLayer(layer) {\n    layer.clear();\n    layer.copyLayer(this);\n    this.clear();\n    return this;\n  }\n\n  render() {\n    let canvas = super.render();\n    return React.cloneElement(canvas, { className: 'oekaki-working-canvas' });\n  }\n}","import React, { Component } from 'react';\nimport WorkingLayer from './WorkingLayer';\nimport Layer from './Layer';\n\nexport default class OekakiPage extends Component {\n  constructor({oekaki}) {\n    super();\n    this.oekaki = oekaki;\n    this.layers = [];\n\n    let bg = this.newLayer('Background');\n    bg.isBg = true;\n  }\n\n  componentDidMount() {\n    this.updateLayers();\n  }\n\n  newLayer(name) {\n    let layer = {\n      name: name,\n      isBg: false,\n      layer: null\n    }\n\n    this.layers.push(layer);\n    this.setActiveLayer(this.layers.length - 1);\n\n    return layer;\n  }\n\n  startDrawing(e) {\n    e.preventDefault();\n    this.oekaki.startDrawing(e);\n  }\n\n  updateLayers() {\n    this.forceUpdate();\n    this.oekaki.updateLayers(this.layers);\n  }\n\n  addLayer(name) {\n    this.newLayer(name);\n    this.updateLayers();\n  }\n\n  removeLayer(i) {\n    var layer = this.getLayer(i);\n\n    if (layer.isBg || this.layers.length === 1) {\n      // Can't remove bg layer\n      return false;\n    }\n\n    this.layers.splice(i, 1);\n    this.updateLayers();\n\n    if (i === this.activeLayerIdx) {\n      // set a new active layer\n      this.setActiveLayer(i < 1? i + 1 : i - 1);\n    }\n  }\n\n  getLayer = (i) => this.layers[i].layer;\n  setActiveLayer(i) {\n    this.activeLayerIdx = i;\n    this.oekaki.setState({\n      activeLayerIdx: i\n    });\n  }\n  getActiveLayer = () => this.getLayer(this.activeLayerIdx);\n\n  setLayerPosition(oldPos, newPos) {\n    let layer = this.getLayer(oldPos);\n    this.layers.splice(oldPos, 1);\n    this.layers.splice(newPos, 0, layer);\n    this.updateLayers();\n  }\n\n  render() {\n    return (\n      <div className=\"oekaki-page\"\n\n        onMouseDown={this.startDrawing.bind(this)}\n        onTouchStart={this.startDrawing.bind(this)}\n        style={{ width: this.oekaki.width + \"px\", height: this.oekaki.height + \"px\" }}>\n        \n        {this.layers && this.layers.map(\n          (layer, idx) => {\n              return (\n                <Layer key={layer.name}\n                  isBg={layer.isBg}\n                  ref={el => {\n                      if (this.layers[idx]) {\n                        this.layers[idx].layer = el;\n                      }\n                    }\n                  }\n                  width={this.oekaki.width}\n                  height={this.oekaki.height}\n                  name={layer.name}\n                />\n              )\n            }\n        )}\n        \n        <WorkingLayer ref={el => (this.oekaki.workingCanvas = el)}\n                  width={this.oekaki.width}\n                  height={this.oekaki.height} />\n      </div>\n    )\n  }\n};","export default class Point {\n  constructor(x, y) {\n    if (typeof x == 'object') {\n      y = x.y;\n      x = x.x;\n    }\n\n    this.x = x;\n    this.y = y;\n  }\n\n  getDistance(point) {\n    var diff = this.getDiff(point);\n    return Math.sqrt(Math.pow(diff.x, 2) + Math.pow(diff.y, 2));\n  };\n\n  getMidpoint(point) {\n    var diff = this.getDiff(point);\n    var midpoint = new Point(this.x - diff.x / 2, this.y - diff.y / 2);\n    return midpoint;\n  };\n\n  getAngle(point) {\n    var diff = this.getDiff(point);\n    return Math.atan2(diff.x, diff.y);\n  };\n\n  getDiff(point) {\n    var diff = new Point(this.x - point.x, this.y - point.y);\n    // log([this.x, this.y, point.x, point.y, diff.x, diff.y]);\n    return diff;\n  };\n\n  toObject() {\n    return {\n      x: this.x,\n      y: this.y\n    };\n  }\n}","import DrawingTool from './DrawingTool';\n\nexport default class Brush extends DrawingTool {\n  color;\n  size;\n  opacity;\n  icon = \"brush\";\n  name = \"Brush\";\n\n  constructor(color, size, opacity) {\n    super();\n    this.color = color;\n    this.size = size;\n    this.opacity = opacity;\n  }\n\n  setDrawStyle(context) {\n    super.setDrawStyle(context);\n    context.lineCap = 'round';\n    context.lineJoin = 'round';\n    context.strokeStyle = this.getColor();\n    context.lineWidth = this.getSize();\n    context.fillStyle = '';\n    context.globalAlpha = this.getOpacity() / 100;\n  }\n\n  getStrokeInfo() {\n    let strokeInfo = super.getStrokeInfo();\n    strokeInfo.color = this.getColor();\n    strokeInfo.size = this.getSize();\n    strokeInfo.opacity = this.getOpacity();\n\n    return strokeInfo;\n  }\n\n  setColor(newColor) {\n    this.color = newColor;\n    return this;\n  }\n\n  getColor() {\n    return this.color;\n  }\n\n  setSize(newSize) {\n    this.size = newSize;\n    return this;\n  }\n\n  getSize() {\n    return this.size;\n  }\n\n  setOpacity(newOpacity) {\n    this.opacity = newOpacity;\n    return this;\n  }\n\n  getOpacity() {\n    return this.opacity;\n  }\n}","import Point from './Point';\nimport Tool from './Tool';\n\nexport default class DrawingTool extends Tool {\n  position = null;\n  path = [];\n  iconObject;\n\n  getPath() {\n    return this.path;\n  }\n\n  clearPath() {\n    var stroke = this.getStrokeInfo();\n    this.path = [];\n    return stroke;\n  }\n\n  getStrokeInfo() {\n    return {\n      path: this.getPath()\n    };\n  }\n\n  beginPath(context, point) {\n    context.moveTo(point.x, point.y);\n    context.beginPath();\n    return this;\n  }\n\n  pathSegment(context, fromPoint, toPoint) {\n    var midpoint = fromPoint.getMidpoint(toPoint);\n    context.quadraticCurveTo(fromPoint.x, fromPoint.y, midpoint.x, midpoint.y);\n    return midpoint;\n  }\n\n  endPath(context) {\n    context.stroke();\n    context.closePath();\n    return this;\n  }\n\n  setDrawStyle(context) {\n    return this;\n  }\n\n  draw(context) {\n    context.save();\n    this.setDrawStyle(context);\n\n    let path = this.getPath();\n    if (path.length < 1) {\n      return\n    }\n\n    let toPoint;\n    let fromPoint = new Point(path[0]);\n\n    this.beginPath(context, fromPoint);\n\n    for (var i = 1; i < path.length; i++) {\n      toPoint = new Point(path[i]);\n      fromPoint = this.pathSegment(context, fromPoint, toPoint);\n    }\n\n    this.endPath(context);\n    context.restore();\n\n    return this;\n  }\n\n  isDot() {\n    return this.path.length === 1;\n  }\n\n  addToPath(positions) {\n    for (var i = 0; i < positions.length; ++i) {\n      this.setPosition(positions[i].x, positions[i].y);\n    }\n\n    return this;\n  }\n\n  setPosition(x, y) {\n    if (typeof x == 'object') {\n      y = x.y;\n      x = x.x;\n    }\n    \n    this.position = {x: x, y: y};\n    this.path.unshift(this.position);\n    return this;\n  }\n\n  getPosition() {\n    return {...this.position};\n  }\n\n  setIconObject(toolIcon) {\n    this.iconObject = toolIcon;\n  }\n\n  setActive(activeBool) {\n    if (!this.iconObject) {\n      console.log(\"No icon object\");\n      return;\n    }\n    \n    console.log(this.iconObject, activeBool);\n    this.iconObject.setActive(activeBool);\n  }\n}","import Brush from './Brush';\n\nexport default class Eraser extends Brush {\n  icon = \"eraser\";\n  name = \"Eraser\";\n\n  constructor(size, opacity) {\n    super(size, opacity, 'transparent');\n\n    this.size = size;\n    this.opacity = opacity;\n  }\n\n  getStrokeInfo() {\n    let strokeInfo = super.getStrokeInfo();\n    delete strokeInfo.color;\n    return strokeInfo;\n  }\n\n  setDrawStyle(context) {\n    super.setDrawStyle(context);\n    context.globalCompositeOperation = 'destination-out';\n  }\n}","import React, { Component } from 'react';\n\nexport default class ToolIcon extends Component {\n\tclassName;\n\ttool;\n\tstate = {\n\t\tisActive: null,\n\t\tclassName: ''\n\t};\n\n\tconstructor({onClick, tool, isActive}) {\n\t\tsuper();\n\t\t\n\t\tthis.state.isActive = isActive;\n\t\tthis.tool = tool;\n\t\tthis.tool.setIconObject(this);\n\t\tthis.onClick = onClick;\n\t}\n\n\tsetActive(isActiveBool) {\n\t\tthis.setState({\n\t\t\tisActive: isActiveBool\n\t\t});\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div onClick={this.onClick} className={this.state.isActive? \"oekaki-tool oekaki-tool-active\" : \"oekaki-tool\"} title={this.tool.name}>\n\t\t\t\t{this.tool.name}\n\t\t\t</div>\n\t\t)\n\t}\n}","function getEventPosition(e, elem, zoom) {\n\tvar events = getEventPositions(e, elem, zoom);\n\treturn events[0];\n}\n\nfunction getEventPositions(e, elem, zoom) {\n\tvar events = [];\n\n\tif (!zoom) {\n\t\tzoom = 1;\n\t}\n\n\tvar getPosition = function(elem, clientX, clientY) {\n\t\tvar rect = elem.getBoundingClientRect();\n\n\t\tvar x = clientX - rect.x,\n\t\t\ty = clientY - rect.y;\n\t\t\n\t\treturn { x: x * 1/zoom, y: y * 1/zoom };\n\t}\n\n\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n\t\tvar touch = e.touches[0] || e.changedTouches[0];\n\n\t\tif (!elem) {\n\t\t\telem = touch.target;\n\t\t}\n\t\t\n\t\tevents.push(getPosition(elem, touch.clientX, touch.clientY));\n\t} else {\n\t\tevents.push(getPosition(elem, e.clientX, e.clientY));\n\t}\n\n\treturn events;\n}\n\nexport default null;\nexport { getEventPosition, getEventPositions };","import React, { Component } from 'react';\nimport OekakiPage from './OekakiPage';\nimport Brush from './Tools/Brush';\nimport Eraser from './Tools/Eraser';\nimport ToolIcon from './ToolIcon';\nimport './Oekaki.scss';\nimport { getEventPositions } from '../helpers';\n\nexport default class Oekaki extends Component {\n  width;\n  height;\n  brush;\n  workingCanvas;\n  history = [];\n  redoHistory = [];\n  currentTool;\n  flags = {\n    \"drawing\": false\n  };\n  state = {\n    layers: [],\n    activeLayerIdx: null\n  };\n\n  constructor({width, height}) {\n    super();\n    this.width = width;\n    this.height = height;\n    this.tools = {\n      brush: new Brush('#000000', 10, 100),\n      eraser: new Eraser(10, 100)\n    };\n    console.log(this);\n  }\n\n  get tool() {\n    return this.tools[this.currentTool];\n  }\n\n  componentDidMount() {\n    this.setCurrentTool(\"brush\");\n  }\n\n  logAction(action, state) {\n    if (typeof state == \"undefined\") {\n      state = {};\n    }\n\n    if (action in [\"brush\"]) {\n      state.layer = this.page.activeLayerIdx;\n    }\n\n    state.action = action;\n    this.history.push(state);\n    this.redoHistory = [];\n  }\n\n  setCurrentTool(toolName) {\n    if (toolName in this.tools) {\n      this.currentTool = toolName;\n\n      for (var curToolName in this.tools) {\n        if (curToolName === toolName) {\n          this.tools[curToolName].setActive(true);\n        } else {\n          this.tools[curToolName].setActive(false);\n        }\n      }\n    }\n  }\n\n  startDrawing(e) {\n    this.flags.drawing = true;\n    this.draw(e);\n    this.page.getActiveLayer().hide();\n  }\n\n  drag(e) {\n    e.preventDefault();\n    if (this.flags.drawing) {\n      this.draw(e);\n    }\n  }\n\n  draw(e) {\n    let posish = getEventPositions(e, this.workingCanvas.canvas);\n    let activeLayer = this.page.getActiveLayer();\n    this.tool.addToPath(posish);\n\n    this.workingCanvas.clear().copyLayer(activeLayer);\n\n    this.tool.draw(this.workingCanvas.getContext());\n  }\n\n  stopDrawing(e) {\n    e.preventDefault();\n    if (this.flags.drawing) {\n      let activeLayer = this.page.getActiveLayer();\n\n      this.workingCanvas.commitToLayer(activeLayer);\n      activeLayer.show();\n\n      let stroke = this.tool.clearPath();\n      this.logAction(\"brush\", {\n        stroke: stroke\n      });\n\n      this.flags.drawing = false;\n    }\n  }\n\n  updateLayers(layers) {\n    // Update the layers list in the toolbar\n    this.setState({layers: layers});\n  }\n\n  render() {\n    return (\n      <div className=\"oekaki-container\"\n        onMouseMove={this.drag.bind(this)}\n        onMouseUp={this.stopDrawing.bind(this)}\n        onTouchMove={this.drag.bind(this)}\n        onTouchEnd={this.stopDrawing.bind(this)}\n      >\n        <div className=\"oekaki-rows\">\n          <div className=\"oekaki-toolbar\">\n            {Object.entries(this.tools).map(\n              ([toolKey, tool]) => {\n                // maybe not necessary\n                let toolOnClickClosure = (\n                  key => (_ => this.setCurrentTool(key))\n                )(toolKey);\n\n                return (\n                  <ToolIcon\n                    onClick={toolOnClickClosure.bind(this)}\n                    key={toolKey}\n                    tool={tool} />\n                )\n              }\n            )}\n\n            <div className=\"oekaki-layers oekaki-panel\">\n              <div className=\"oekaki-panel-title\">Layers</div>\n              <div className=\"oekaki-panel-body\">\n                {this.state.layers.slice(0).reverse().map((layer, i) => {\n                    let idx = this.state.layers.length - i - 1;\n                    return (<div\n                        key={idx}\n                        onClick={() => this.page.setActiveLayer(idx)}\n                        className={idx === this.state.activeLayerIdx? \"oekaki-layer oekaki-layer-active\" : \"oekaki-layer\"}>\n                          {layer.name}\n                        </div>)\n                })}\n                <div className=\"oekaki-layer-tools\">\n                  <div className=\"oekaki-layer-tool\" onClick={() => {\n                      let layerName = prompt(\"Enter Layer Name\", \"Layer \" + this.state.layers.length);\n                      if (layerName) {\n                        this.page.addLayer(layerName);\n                      }\n                    }\n                  } title=\"Add New\">+</div>\n\n                  { this.state.layers.length > 1 && !this.state.layers[this.state.activeLayerIdx].isBg && <div className=\"oekaki-layer-tool\" onClick={() => {\n                      if (window.confirm(\"Are you sure you want to remove the current layer?\")) {\n                        this.page.removeLayer(this.state.activeLayerIdx);\n                      }\n                    }\n                  } title=\"Add New\">-</div> }\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <OekakiPage ref={el => (this.page = el)} oekaki={this} />\n        </div>\n      </div>\n    )\n  }\n};","import React from 'react';\nimport Oekaki from './components/Oekaki/Oekaki';\nimport './App.css';\n\nfunction App() {\n  return (\n    <Oekaki width=\"500\" height=\"500\"></Oekaki>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}