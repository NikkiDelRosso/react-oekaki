(this["webpackJsonpreact-oekaki"]=this["webpackJsonpreact-oekaki"]||[]).push([[0],{12:function(t,e,a){t.exports=a(20)},17:function(t,e,a){},18:function(t,e,a){},19:function(t,e,a){},20:function(t,e,a){"use strict";a.r(e);var i=a(0),n=a.n(i),r=a(9),o=a.n(r),s=(a(17),a(10)),c=a(2),h=a(3),l=a(4),u=a(1),y=a(7),v=a(5),k=a(6),f=function(t){function e(t){var a,i=t.width,n=t.height,r=t.name;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this))).width=i,a.height=n,a.name=r,a}return Object(v.a)(e,t),Object(h.a)(e,[{key:"getContext",value:function(){return this.canvas.getContext("2d")}},{key:"copyLayer",value:function(t){return this.getContext().drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height),this}},{key:"clear",value:function(){return this.getContext().clearRect(0,0,this.canvas.width,this.canvas.height),this}},{key:"hide",value:function(){this.canvas.style.display="none"}},{key:"show",value:function(){this.canvas.style.display=""}},{key:"render",value:function(){return n.a.createElement("canvas",{ref:"canvas","data-layer-name":this.name,width:this.width,height:this.height})}},{key:"canvas",get:function(){return this.refs.canvas}}]),e}(i.Component),g=function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(h.a)(e,[{key:"commitToLayer",value:function(t){return t.clear(),t.copyLayer(this),this.clear(),this}},{key:"render",value:function(){var t=Object(k.a)(Object(u.a)(e.prototype),"render",this).call(this);return n.a.cloneElement(t,{className:"oekaki-working-canvas"})}}]),e}(f),d=function(t){function e(t){var a,i=t.oekaki;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this))).getLayer=function(t){return a.layers[t].layer},a.getActiveLayer=function(){return a.getLayer(a.activeLayerIdx)},a.oekaki=i,a.layers=[],a.newLayer("Background").isBg=!0,a}return Object(v.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){this.updateLayers()}},{key:"newLayer",value:function(t){var e={name:t,isBg:!1,layer:null};return this.layers.push(e),this.setActiveLayer(this.layers.length-1),e}},{key:"startDrawing",value:function(t){t.preventDefault(),this.oekaki.startDrawing(t)}},{key:"updateLayers",value:function(){this.forceUpdate(),this.oekaki.updateLayers(this.layers)}},{key:"addLayer",value:function(t){this.newLayer(t),this.updateLayers()}},{key:"removeLayer",value:function(t){if(this.getLayer(t).isBg||1===this.layers.length)return!1;this.layers.splice(t,1),this.updateLayers(),t===this.activeLayerIdx&&this.setActiveLayer(t<1?t+1:t-1)}},{key:"setActiveLayer",value:function(t){this.activeLayerIdx=t,this.oekaki.setState({activeLayerIdx:t})}},{key:"setLayerPosition",value:function(t,e){var a=this.getLayer(t);this.layers.splice(t,1),this.layers.splice(e,0,a),this.updateLayers()}},{key:"render",value:function(){var t=this;return n.a.createElement("div",{className:"oekaki-page",onMouseDown:this.startDrawing.bind(this),onTouchStart:this.startDrawing.bind(this),style:{width:this.oekaki.width+"px",height:this.oekaki.height+"px"}},this.layers&&this.layers.map((function(e,a){return n.a.createElement(f,{key:e.name,isBg:e.isBg,ref:function(e){t.layers[a]&&(t.layers[a].layer=e)},width:t.oekaki.width,height:t.oekaki.height,name:e.name})})),n.a.createElement(g,{ref:function(e){return t.oekaki.workingCanvas=e},width:this.oekaki.width,height:this.oekaki.height}))}}]),e}(i.Component),p=a(11),b=function(){function t(e,a){Object(c.a)(this,t),"object"==typeof e&&(a=e.y,e=e.x),this.x=e,this.y=a}return Object(h.a)(t,[{key:"getDistance",value:function(t){var e=this.getDiff(t);return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}},{key:"getMidpoint",value:function(e){var a=this.getDiff(e);return new t(this.x-a.x/2,this.y-a.y/2)}},{key:"getAngle",value:function(t){var e=this.getDiff(t);return Math.atan2(e.x,e.y)}},{key:"getDiff",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}}]),t}(),m=function(t){function e(t,a,i){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this))).icon="brush",n.name="Brush",n.color=t,n.size=a,n.opacity=i,n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setDrawStyle",value:function(t){Object(k.a)(Object(u.a)(e.prototype),"setDrawStyle",this).call(this,t),t.lineCap="round",t.lineJoin="round",t.strokeStyle=this.getColor(),t.lineWidth=this.getSize(),t.fillStyle="",t.globalAlpha=this.getOpacity()/100}},{key:"getStrokeInfo",value:function(){var t=Object(k.a)(Object(u.a)(e.prototype),"getStrokeInfo",this).call(this);return t.color=this.getColor(),t.size=this.getSize(),t.opacity=this.getOpacity(),t}},{key:"setColor",value:function(t){return this.color=t,this}},{key:"getColor",value:function(){return this.color}},{key:"setSize",value:function(t){return this.size=t,this}},{key:"getSize",value:function(){return this.size}},{key:"setOpacity",value:function(t){return this.opacity=t,this}},{key:"getOpacity",value:function(){return this.opacity}}]),e}(function(t){function e(){var t,a;Object(c.a)(this,e);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(a=Object(l.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(n)))).position=null,a.path=[],a}return Object(v.a)(e,t),Object(h.a)(e,[{key:"getPath",value:function(){return this.path}},{key:"clearPath",value:function(){var t=this.getStrokeInfo();return this.path=[],t}},{key:"getStrokeInfo",value:function(){return{path:this.getPath()}}},{key:"beginPath",value:function(t,e){return t.moveTo(e.x,e.y),t.beginPath(),this}},{key:"pathSegment",value:function(t,e,a){var i=e.getMidpoint(a);return t.quadraticCurveTo(e.x,e.y,i.x,i.y),i}},{key:"endPath",value:function(t){return t.stroke(),t.closePath(),this}},{key:"setDrawStyle",value:function(t){return this}},{key:"draw",value:function(t){t.save(),this.setDrawStyle(t);var e=this.getPath();if(!(e.length<1)){var a,i=new b(e[0]);this.beginPath(t,i);for(var n=1;n<e.length;n++)a=new b(e[n]),i=this.pathSegment(t,i,a);return this.endPath(t),t.restore(),this}}},{key:"isDot",value:function(){return 1===this.path.length}},{key:"addToPath",value:function(t){for(var e=0;e<t.length;++e)this.setPosition(t[e].x,t[e].y);return this}},{key:"setPosition",value:function(t,e){return"object"==typeof t&&(e=t.y,t=t.x),this.position={x:t,y:e},this.path.unshift(this.position),this}},{key:"getPosition",value:function(){return Object(p.a)({},this.position)}},{key:"setIconObject",value:function(t){this.iconObject=t}},{key:"setActive",value:function(t){this.iconObject?(console.log(this.iconObject,t),this.iconObject.setActive(t)):console.log("No icon object")}}]),e}((function t(){Object(c.a)(this,t)}))),w=function(t){function e(t,a){var i;return Object(c.a)(this,e),(i=Object(l.a)(this,Object(u.a)(e).call(this,t,a,"transparent"))).icon="eraser",i.name="Eraser",i.size=t,i.opacity=a,i}return Object(v.a)(e,t),Object(h.a)(e,[{key:"getStrokeInfo",value:function(){var t=Object(k.a)(Object(u.a)(e.prototype),"getStrokeInfo",this).call(this);return delete t.color,t}},{key:"setDrawStyle",value:function(t){Object(k.a)(Object(u.a)(e.prototype),"setDrawStyle",this).call(this,t),t.globalCompositeOperation="destination-out"}}]),e}(m),O=function(t){function e(t){var a,i=t.onClick,n=t.tool,r=t.isActive;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this))).state={isActive:null,className:""},a.state.isActive=r,a.tool=n,a.tool.setIconObject(Object(y.a)(a)),a.onClick=i,a}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setActive",value:function(t){this.setState({isActive:t})}},{key:"render",value:function(){return n.a.createElement("div",{onClick:this.onClick,className:this.state.isActive?"oekaki-tool oekaki-tool-active":"oekaki-tool",title:this.tool.name},this.tool.name)}}]),e}(i.Component);a(18);function j(t,e,a){var i=[];a||(a=1);var n=function(t,e,i){var n=t.getBoundingClientRect(),r=e-n.x,o=i-n.y;return{x:1*r/a,y:1*o/a}};if("touchstart"===t.type||"touchmove"===t.type||"touchend"===t.type||"touchcancel"===t.type){var r=t.touches[0]||t.changedTouches[0];e||(e=r.target),i.push(n(e,r.clientX,r.clientY))}else i.push(n(e,t.clientX,t.clientY));return i}var L=function(t){function e(t){var a,i=t.width,n=t.height;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this))).history=[],a.redoHistory=[],a.flags={drawing:!1},a.state={layers:[],activeLayerIdx:null},a.width=i,a.height=n,a.tools={brush:new m("#000000",10,100),eraser:new w(10,100)},console.log(Object(y.a)(a)),a}return Object(v.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){this.setCurrentTool("brush")}},{key:"logAction",value:function(t,e){"undefined"==typeof e&&(e={}),t in["brush"]&&(e.layer=this.page.activeLayerIdx),e.action=t,this.history.push(e),this.redoHistory=[]}},{key:"setCurrentTool",value:function(t){if(t in this.tools)for(var e in this.currentTool=t,this.tools)e===t?this.tools[e].setActive(!0):this.tools[e].setActive(!1)}},{key:"startDrawing",value:function(t){this.flags.drawing=!0,this.draw(t),this.page.getActiveLayer().hide()}},{key:"drag",value:function(t){t.preventDefault(),this.flags.drawing&&this.draw(t)}},{key:"draw",value:function(t){var e=j(t,this.workingCanvas.canvas),a=this.page.getActiveLayer();this.tool.addToPath(e),this.workingCanvas.clear().copyLayer(a),this.tool.draw(this.workingCanvas.getContext())}},{key:"stopDrawing",value:function(t){if(t.preventDefault(),this.flags.drawing){var e=this.page.getActiveLayer();this.workingCanvas.commitToLayer(e),e.show();var a=this.tool.clearPath();this.logAction("brush",{stroke:a}),this.flags.drawing=!1}}},{key:"updateLayers",value:function(t){this.setState({layers:t})}},{key:"render",value:function(){var t=this;return n.a.createElement("div",{className:"oekaki-container",onMouseMove:this.drag.bind(this),onMouseUp:this.stopDrawing.bind(this),onTouchMove:this.drag.bind(this),onTouchEnd:this.stopDrawing.bind(this)},n.a.createElement("div",{className:"oekaki-rows"},n.a.createElement("div",{className:"oekaki-toolbar"},Object.entries(this.tools).map((function(e){var a,i=Object(s.a)(e,2),r=i[0],o=i[1],c=(a=r,function(e){return t.setCurrentTool(a)});return n.a.createElement(O,{onClick:c.bind(t),key:r,tool:o})})),n.a.createElement("div",{className:"oekaki-layers oekaki-panel"},n.a.createElement("div",{className:"oekaki-panel-title"},"Layers"),n.a.createElement("div",{className:"oekaki-panel-body"},this.state.layers.slice(0).reverse().map((function(e,a){var i=t.state.layers.length-a-1;return n.a.createElement("div",{key:i,onClick:function(){return t.page.setActiveLayer(i)},className:i===t.state.activeLayerIdx?"oekaki-layer oekaki-layer-active":"oekaki-layer"},e.name)})),n.a.createElement("div",{className:"oekaki-layer-tools"},n.a.createElement("div",{className:"oekaki-layer-tool",onClick:function(){var e=prompt("Enter Layer Name","Layer "+t.state.layers.length);e&&t.page.addLayer(e)},title:"Add New"},"+"),this.state.layers.length>1&&!this.state.layers[this.state.activeLayerIdx].isBg&&n.a.createElement("div",{className:"oekaki-layer-tool",onClick:function(){window.confirm("Are you sure you want to remove the current layer?")&&t.page.removeLayer(t.state.activeLayerIdx)},title:"Add New"},"-"))))),n.a.createElement(d,{ref:function(e){return t.page=e},oekaki:this})))}},{key:"tool",get:function(){return this.tools[this.currentTool]}}]),e}(i.Component);a(19);var x=function(){return n.a.createElement(L,{width:"500",height:"500"})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[12,1,2]]]);
//# sourceMappingURL=main.a4ba8f87.chunk.js.map